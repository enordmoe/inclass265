<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Your Name Here">

<title>Introduction to Dates and Times in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Practice_Dates_and_Times_files/libs/clipboard/clipboard.min.js"></script>
<script src="Practice_Dates_and_Times_files/libs/quarto-html/quarto.js"></script>
<script src="Practice_Dates_and_Times_files/libs/quarto-html/popper.min.js"></script>
<script src="Practice_Dates_and_Times_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Practice_Dates_and_Times_files/libs/quarto-html/anchor.min.js"></script>
<link href="Practice_Dates_and_Times_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Practice_Dates_and_Times_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Practice_Dates_and_Times_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Practice_Dates_and_Times_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Practice_Dates_and_Times_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#using-lubridate-to-calculate-the-dates-of-holidays" id="toc-using-lubridate-to-calculate-the-dates-of-holidays" class="nav-link active" data-scroll-target="#using-lubridate-to-calculate-the-dates-of-holidays">1. Using <strong>lubridate</strong> to calculate the dates of holidays</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#exercise-2-the-lakers-data-set" id="toc-exercise-2-the-lakers-data-set" class="nav-link" data-scroll-target="#exercise-2-the-lakers-data-set">Exercise 2: The <strong>lakers</strong> data set</a>
  <ul class="collapse">
  <li><a href="#home-and-away" id="toc-home-and-away" class="nav-link" data-scroll-target="#home-and-away">Home and Away</a></li>
  <li><a href="#distribution-by-day-of-week" id="toc-distribution-by-day-of-week" class="nav-link" data-scroll-target="#distribution-by-day-of-week">Distribution by Day of Week</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  </ul></li>
  <li><a href="#distribution-of-plays-througought-the-game" id="toc-distribution-of-plays-througought-the-game" class="nav-link" data-scroll-target="#distribution-of-plays-througought-the-game">2. Distribution of Plays Througought the Game</a>
  <ul class="collapse">
  <li><a href="#analyzing-a-single-game" id="toc-analyzing-a-single-game" class="nav-link" data-scroll-target="#analyzing-a-single-game">Analyzing a Single Game</a></li>
  </ul></li>
  <li><a href="#on-your-own" id="toc-on-your-own" class="nav-link" data-scroll-target="#on-your-own">3. On Your Own</a>
  <ul class="collapse">
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4</a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5">Exercise 5</a></li>
  </ul></li>
  <li><a href="#lakers-data-set-variables-and-descriptions" id="toc-lakers-data-set-variables-and-descriptions" class="nav-link" data-scroll-target="#lakers-data-set-variables-and-descriptions">4. Lakers data set variables and descriptions</a></li>
  <li><a href="#acknowledgement" id="toc-acknowledgement" class="nav-link" data-scroll-target="#acknowledgement">5. Acknowledgement</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Dates and Times in R</h1>
<p class="subtitle lead">Chapter 17</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Your Name Here </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="using-lubridate-to-calculate-the-dates-of-holidays" class="level1">
<h1>1. Using <strong>lubridate</strong> to calculate the dates of holidays</h1>
<p>Let’s get to know some of the commands in <strong>lubridate</strong> to calculate the dates of holidays. Some holidays like Thanksgiving and Memorial Day do not occur on the same date each year. We will use <strong>lubridate</strong> to find the date on which Thanksgiving will fall in the year 2025.</p>
<p>First, note that Thanksgiving in the US is celebrated on the fourth Thursday of November. Let’s start by getting a representation of the first day of 2025.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2025-01-01"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-01-01"</code></pre>
</div>
</div>
<p>Now add 10 months using the period function <code>month()</code> or directly set the date to November:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(date <span class="ot">&lt;-</span> date <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-11-01"</code></pre>
</div>
</div>
<p>Now check which day of the week November 1st is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Saturday
7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday</code></pre>
</div>
</div>
<p>This implies November 6th will be the first Thursday of November.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(date <span class="ot">&lt;-</span> date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-11-06"</code></pre>
</div>
</div>
<p>Next, we add three weeks to get to the fourth Thursday in November, which will be Thanksgiving:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(date <span class="ot">&lt;-</span> date <span class="sc">+</span> <span class="fu">weeks</span>(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-11-27"</code></pre>
</div>
</div>
</section>
<section id="exercise-1" class="level1">
<h1>Exercise 1</h1>
<p>Follow the steps above to find the date for Thanksgiving in the year 2030.</p>
</section>
<section id="exercise-2-the-lakers-data-set" class="level1">
<h1>Exercise 2: The <strong>lakers</strong> data set</h1>
<p>The <strong>lakers</strong> data set contains play by play statistics of every NBA regular season basketball game played by the Los Angeles Lakers during the 2008-09 season. This data set accompanies the <strong>lubridate</strong> package so there is no need to import it from an external source. (Note: The data were originally sourced from http://www.basketballgeek.com/data ). But for convenience, the following code chunk converts it into a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following command is useful if you need to re-run all commands during troubleshooting</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># It removes previous versions of **lakers** from the local environment</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(lakers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rm(lakers): object 'lakers' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the data set to a tibble for convenience  </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>lakers <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(lakers)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use the <code>View()</code> command to look at the data set. For background, NBA teams play 82 games per year, typically half of which are “at home” and half are away. A regular game has 48 minutes split into 4 periods of 12 minutes each. Overtime periods, if required by a tie at the end of 48 minutes, are each 5 minutes in length.</p>
<p>This tutorial uses the <strong>lubridate</strong> functions to explore the distribution of Lakers’ games throughout the year and the distributions of plays within games. Each case (observation) is an individual “play” which includes everything from a “jump ball” at the beginning of the game to a “rebound” or “shot”. You can use <code>glimpse()</code> to look at the variables but the Appendix has a list of the names with a brief description of each.</p>
<p>You will see that the <strong>lakers</strong> data set has a variable <em>date</em> that records the date of each game. Note from the output of <code>glimpse()</code> that R recognizes the dates in this format as integers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(lakers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 34,624
Columns: 13
$ date      &lt;int&gt; 20081028, 20081028, 20081028, 20081028, 20081028, 20081028, …
$ opponent  &lt;chr&gt; "POR", "POR", "POR", "POR", "POR", "POR", "POR", "POR", "POR…
$ game_type &lt;chr&gt; "home", "home", "home", "home", "home", "home", "home", "hom…
$ time      &lt;chr&gt; "12:00", "11:39", "11:37", "11:25", "11:23", "11:22", "11:22…
$ period    &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ etype     &lt;chr&gt; "jump ball", "shot", "rebound", "shot", "rebound", "shot", "…
$ team      &lt;chr&gt; "OFF", "LAL", "LAL", "LAL", "LAL", "LAL", "POR", "LAL", "LAL…
$ player    &lt;chr&gt; "", "Pau Gasol", "Vladimir Radmanovic", "Derek Fisher", "Pau…
$ result    &lt;chr&gt; "", "missed", "", "missed", "", "made", "", "made", "", "mad…
$ points    &lt;int&gt; 0, 0, 0, 0, 0, 2, 0, 1, 0, 2, 2, 0, 0, 2, 2, 0, 0, 2, 0, 0, …
$ type      &lt;chr&gt; "", "hook", "off", "layup", "off", "hook", "shooting", "", "…
$ x         &lt;int&gt; NA, 23, NA, 25, NA, 25, NA, NA, NA, 36, 30, 34, NA, 15, 46, …
$ y         &lt;int&gt; NA, 13, NA, 6, NA, 10, NA, NA, NA, 21, 21, 10, NA, 17, 9, 10…</code></pre>
</div>
</div>
<p>We can use the <strong>lubridate</strong> function to parse the dates into date-time objects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lakers <span class="ot">&lt;-</span> <span class="fu">mutate</span>(lakers, <span class="at">date =</span> <span class="fu">ymd</span>(date))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lakers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  date       opponent game_type time  period etype    team  player result points
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;
1 2008-10-28 POR      home      12:00      1 jump ba… OFF   ""     ""          0
2 2008-10-28 POR      home      11:39      1 shot     LAL   "Pau … "miss…      0
3 2008-10-28 POR      home      11:37      1 rebound  LAL   "Vlad… ""          0
4 2008-10-28 POR      home      11:25      1 shot     LAL   "Dere… "miss…      0
5 2008-10-28 POR      home      11:23      1 rebound  LAL   "Pau … ""          0
6 2008-10-28 POR      home      11:22      1 shot     LAL   "Pau … "made"      2
# ℹ 3 more variables: type &lt;chr&gt;, x &lt;int&gt;, y &lt;int&gt;</code></pre>
</div>
</div>
<section id="home-and-away" class="level2">
<h2 class="anchored" data-anchor-id="home-and-away">Home and Away</h2>
<p>R now recognizes the dates as date-time-objects so that we can plot them as dates which will be correctly displayed. One useful first step is to plot the games over times and flag them as home or away:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Don't worry about the y-scale</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>lakers <span class="sc">|&gt;</span> <span class="fu">distinct</span>(date, game_type) <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">color =</span> game_type)) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practice_Dates_and_Times_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that home and away games tend to cluster in streaks rather than alternating every other game. We see breaks around the holiday season and for the all-star game in February. The tick marks and breaks are automatically generated.</p>
</section>
<section id="distribution-by-day-of-week" class="level2">
<h2 class="anchored" data-anchor-id="distribution-by-day-of-week">Distribution by Day of Week</h2>
<p>Lets consider how the games are distributed throughout the week. That is, are games equally likely to be played on any day of the week or are some more likely than others? Use the <strong>lubridate</strong> function <code>wday()</code> to obtain the day of the week of each game.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lakers <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(date) <span class="sc">|&gt;</span>  </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dayofwk =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dayofwk)) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practice_Dates_and_Times_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="exercise-2" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2">Exercise 2</h2>
<p>On which day of the week is the largest number of games played? On which two days are the least number of games played?</p>
<p><strong>Answer:</strong></p>
</section>
<section id="exercise-3" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3">Exercise 3</h2>
<p>Repeat the analysis above but instead of day of week, look at the month of the game. You should be able to adapt the code above but use the <code>month()</code> function without abbreviation. Put the months in order of the season which runs from October to April. Hint: You will probably need to explicitly declare the month of the game as a factor for the appropriate <code>fct_xxx()</code> reordering command to work. In which month(s) did the Lakers play the most/least games?</p>
<p><strong>Answer:</strong></p>
</section>
</section>
<section id="distribution-of-plays-througought-the-game" class="level1">
<h1>2. Distribution of Plays Througought the Game</h1>
<p>Now let’s look at the play level data to see how the the plays are distributed throughout the game. The <strong>lakers</strong> data set lists as <em>time</em> the time that appears on the game clock for each play. These times begin at the beginning of the period (at 12:00) and count down to 00:00 at the end of the period. The first two digits show the minutes remaining while the last two digits show the number of seconds remaining.</p>
<p>As the data were loaded, they are stored simply as character data and have not yet been parsed as times or date-times. It would be difficult to record the time data as a date-time object so use <code>ms()</code> to parse it to a period object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>lakers <span class="ot">&lt;-</span> lakers <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> (<span class="fu">ms</span>(time)))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lakers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  date       opponent game_type time     period etype team  player result points
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;Period&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;
1 2008-10-28 POR      home      12M 0S        1 jump… OFF   ""     ""          0
2 2008-10-28 POR      home      11M 39S       1 shot  LAL   "Pau … "miss…      0
3 2008-10-28 POR      home      11M 37S       1 rebo… LAL   "Vlad… ""          0
4 2008-10-28 POR      home      11M 25S       1 shot  LAL   "Dere… "miss…      0
5 2008-10-28 POR      home      11M 23S       1 rebo… LAL   "Pau … ""          0
6 2008-10-28 POR      home      11M 22S       1 shot  LAL   "Pau … "made"      2
# ℹ 3 more variables: type &lt;chr&gt;, x &lt;int&gt;, y &lt;int&gt;</code></pre>
</div>
</div>
<p>Since periods have relative lengths, it is dangerous to compare them to each other. So we should next convert our periods to <em>durations</em> which have exact lengths.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lakers <span class="ot">&lt;-</span> lakers <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">as.duration</span>(time))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(lakers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 13
  date       opponent game_type time     period etype team  player result points
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;Durati&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;
1 2009-04-14 UTA      home      42s           4 foul  LAL   Luke … ""          0
2 2009-04-14 UTA      home      42s           4 free… UTA   Kyle … "made"      1
3 2009-04-14 UTA      home      42s           4 free… UTA   Kyle … "made"      1
4 2009-04-14 UTA      home      27s           4 turn… LAL   Andre… ""          0
5 2009-04-14 UTA      home      21s           4 shot  UTA   Kyle … "miss…      0
6 2009-04-14 UTA      home      20s           4 rebo… LAL   Luke … ""          0
# ℹ 3 more variables: type &lt;chr&gt;, x &lt;int&gt;, y &lt;int&gt;</code></pre>
</div>
</div>
<p>See how the representation of <em>time</em> has changed? Unfortunately, <strong>ggplot2</strong> will not plot a histogram of durations so we need to convert time to a <strong>period</strong> for plotting purposes. (This appears to be something of a bug since earlier work on <strong>lubridate</strong> suggests this should be possible.)</p>
<p>For the current analysis, it will be useful to proceed to construct a variable that represents the amount of time elapsed in the game beginning at 0 and extending to the end of the game, up to 48 minutes for a regular length game or 53 minutes for an overtime game. At the start of each period, the game clocks counts down from 12:00. To calculate how much play time elapses before each play, we subtract the time that appears on the game clock from a duration of 12, 24, 36, 48, or 53 minutes (depending on the period of play). We now have a new duration that shows exactly how far into the game each play occurred. You may need to study the code to understand how it’s working. It uses indexing to grab the number of minutes corresponding to the period.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lakers <span class="ot">&lt;-</span> lakers <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">newtime =</span>(<span class="fu">dminutes</span>(<span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">36</span>, <span class="dv">48</span>, <span class="dv">53</span>)[period]) <span class="sc">-</span> time))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lakers<span class="sc">$</span>newtime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Formal class 'Duration' [package "lubridate"] with 1 slot
  ..@ .Data: num [1:34624] 0 21 23 35 37 38 38 38 60 67 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lakers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  date       opponent game_type time                  period etype  team  player
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;Duration&gt;             &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; 
1 2008-10-28 POR      home      720s (~12 minutes)         1 jump … OFF   ""    
2 2008-10-28 POR      home      699s (~11.65 minutes)      1 shot   LAL   "Pau …
3 2008-10-28 POR      home      697s (~11.62 minutes)      1 rebou… LAL   "Vlad…
4 2008-10-28 POR      home      685s (~11.42 minutes)      1 shot   LAL   "Dere…
5 2008-10-28 POR      home      683s (~11.38 minutes)      1 rebou… LAL   "Pau …
6 2008-10-28 POR      home      682s (~11.37 minutes)      1 shot   LAL   "Pau …
# ℹ 6 more variables: result &lt;chr&gt;, points &lt;int&gt;, type &lt;chr&gt;, x &lt;int&gt;, y &lt;int&gt;,
#   newtime &lt;Duration&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(lakers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  date       opponent game_type time     period etype team  player result points
  &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;Durati&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;int&gt;
1 2009-04-14 UTA      home      42s           4 foul  LAL   Luke … ""          0
2 2009-04-14 UTA      home      42s           4 free… UTA   Kyle … "made"      1
3 2009-04-14 UTA      home      42s           4 free… UTA   Kyle … "made"      1
4 2009-04-14 UTA      home      27s           4 turn… LAL   Andre… ""          0
5 2009-04-14 UTA      home      21s           4 shot  UTA   Kyle … "miss…      0
6 2009-04-14 UTA      home      20s           4 rebo… LAL   Luke … ""          0
# ℹ 4 more variables: type &lt;chr&gt;, x &lt;int&gt;, y &lt;int&gt;, newtime &lt;Duration&gt;</code></pre>
</div>
</div>
<p>Now graph the number of plays by time period. We can use the <code>seconds()</code> command to access seconds from the duration <em>newtime</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>lakers <span class="sc">|&gt;</span>  </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">seconds</span>(newtime))) <span class="sc">+</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practice_Dates_and_Times_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can get an easier to read graph by converting to minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lakers <span class="sc">|&gt;</span>  </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">seconds</span>(newtime)<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">53</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">36</span>, <span class="dv">48</span>, <span class="dv">53</span>)) <span class="sc">+</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Minutes"</span>, <span class="at">y =</span> <span class="st">"Plays"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practice_Dates_and_Times_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the number of plays peaks within each of the four periods and then drops at the beginning of each new period. The most plays occur in the last minute of the game. Desperation shots and strategic fouling may result in the large number of plays at the end of the game. Far fewer plays occur in overtime since only a small portion of all games go to overtime.</p>
<section id="analyzing-a-single-game" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-a-single-game">Analyzing a Single Game</h2>
<p>Now let’s see how we could look at just a single game, the game played against the Boston Celtics on Christmas of 2008. We can quickly model the amounts of time that occurred between each shot attempt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the game of interest</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>game1 <span class="ot">&lt;-</span> lakers  <span class="sc">|&gt;</span>  </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="fu">ymd</span>(<span class="st">"20081225"</span>))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for plays involving shot attempts and compute the time between shots using</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the lag function and the newtime duration variable. Remember that duration represents</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the cumulative time in seconds within the game at which the shot took place.</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>attempts <span class="ot">&lt;-</span> game1 <span class="sc">|&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(etype <span class="sc">==</span> <span class="st">"shot"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wait =</span> newtime<span class="sc">-</span><span class="fu">lag</span>(newtime))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the data set <strong>attempts</strong> containing the duration variable <em>wait</em>, we can plot a histogram of time between shots using the <code>seconds()</code> function to access the seconds component. Use a reasonable binwidth to get a detailed picture of the histogram.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(attempts) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">seconds</span>(wait)), <span class="at">binwidth =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time between shots (secs)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing non-finite values (`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Practice_Dates_and_Times_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Rarely did more than 30 seconds go by without a shot attempt.</p>
<p>One other analysis often of interest with game level data is to track the score against elapsed time. We revisit some of the skills we learned earlier in the term to filter out cases that do not produce points (<code>team~= "OFF"</code>) and compute cumulative points for each time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>game1_scores <span class="ot">&lt;-</span> game1 <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(team <span class="sc">!=</span> <span class="st">"OFF"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(team) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> <span class="fu">cumsum</span>(points))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(game1_scores, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">seconds</span>(newtime)<span class="sc">/</span><span class="dv">60</span>, <span class="at">y =</span> score, <span class="at">color =</span> team))<span class="sc">+</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Minutes Elapsed"</span>, <span class="at">y =</span> <span class="st">"Score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practice_Dates_and_Times_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The game was fairly close throughout with the Lakers maintaining a lead for most of the game They extended their lead right at the end of the game.</p>
</section>
</section>
<section id="on-your-own" class="level1">
<h1>3. On Your Own</h1>
<section id="exercise-4" class="level2">
<h2 class="anchored" data-anchor-id="exercise-4">Exercise 4</h2>
<p>Pick a different game and repeat the analysis carried out above for the game against Boston. Be sure you understand what the code is doing.</p>
</section>
<section id="exercise-5" class="level2">
<h2 class="anchored" data-anchor-id="exercise-5">Exercise 5</h2>
<p>Come up with your own hypothesis and investigate it using the data provided. Here are a few possible examples but you should try to come up with your own:<br>
* Are there more fouls in the last period (and overtime) than in other periods?<br>
* Is the distribution of time between fouls similar to or different from the distribution of time between shots?<br>
* Is the proportion of shots made higher in certain periods than others?</p>
<hr>
</section>
</section>
<section id="lakers-data-set-variables-and-descriptions" class="level1">
<h1>4. Lakers data set variables and descriptions</h1>
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 95%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><em>date</em></td>
<td>date of the game</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>opponent</em></td>
<td>3 letter abbreviation for the opposing team</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><em>game_type</em></td>
<td>whether the game was home or away</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>time</em></td>
<td>time remaining in the period</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><em>period</em></td>
<td>integer representing the period of the game (1 through 5 where 5 is overtime)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>etype</em></td>
<td>the general type of play (one of 10 possible types)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><em>team</em></td>
<td>team involved in the play which could be the home or away team or OFF meaning neither (time outs or jump balls)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>player</em></td>
<td>the player that made the play</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><em>result</em></td>
<td>outcome if the play was a shot (made or missed)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>points</em></td>
<td>number of points scored if a shot or free throws</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><em>type</em></td>
<td>specific type of play or shot (one of 74 specific types)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><em>x</em>, <em>y</em></td>
<td>x and y locations on the court (If you are standing behind the offensive team’s hoop then the X axis runs from left to right and the Y axis runs from bottom to top. The center of the hoop is located at (25, 5.25)).</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="acknowledgement" class="level1">
<h1>5. Acknowledgement</h1>
<p>This tutorial adapts case studies appearing in Grolemund and Wickham in “Dates and Times Made Easy with lubridate” appearing in the <em>Journal of Statistical Software</em>, April 2011, Volume 40, Issue 3, http://www.jstatsoft.org/.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>