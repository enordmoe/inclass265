<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Solutions">

<title>Introduction to Creating Maps with ggplot2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="IntroMakingMaps_solutions_files/libs/clipboard/clipboard.min.js"></script>
<script src="IntroMakingMaps_solutions_files/libs/quarto-html/quarto.js"></script>
<script src="IntroMakingMaps_solutions_files/libs/quarto-html/popper.min.js"></script>
<script src="IntroMakingMaps_solutions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="IntroMakingMaps_solutions_files/libs/quarto-html/anchor.min.js"></script>
<link href="IntroMakingMaps_solutions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="IntroMakingMaps_solutions_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="IntroMakingMaps_solutions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="IntroMakingMaps_solutions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="IntroMakingMaps_solutions_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#making-a-base-map" id="toc-making-a-base-map" class="nav-link" data-scroll-target="#making-a-base-map"><span class="header-section-number">2</span> Making a base map</a></li>
  <li><a href="#customizing-your-choropleth-map" id="toc-customizing-your-choropleth-map" class="nav-link" data-scroll-target="#customizing-your-choropleth-map"><span class="header-section-number">3</span> Customizing your choropleth map</a></li>
  <li><a href="#adding-points-to-your-choropleth-map" id="toc-adding-points-to-your-choropleth-map" class="nav-link" data-scroll-target="#adding-points-to-your-choropleth-map"><span class="header-section-number">4</span> Adding points to your choropleth map</a></li>
  <li><a href="#on-your-own" id="toc-on-your-own" class="nav-link" data-scroll-target="#on-your-own"><span class="header-section-number">5</span> On your own</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources"><span class="header-section-number">6</span> Additional Resources</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements"><span class="header-section-number">7</span> Acknowledgements</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Creating Maps with ggplot2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Solutions </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In this tutorial we will make <strong>choropleth maps</strong>, sometimes called heat maps, using the <code>ggplot2</code> package. <a href="https://www.washingtonpost.com/blogs/worldviews/files/2013/03/openness2.jpg">Here</a> is a typical though very intriguing example from the Washington Post and <a href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Ftimogrossenbacher.ch%2Fbivariate-maps-with-ggplot2-and-sf%2F&amp;psig=AOvVaw2XFo60WW7PFJ1nlqGs9n7n&amp;ust=1709298387955000&amp;source=images&amp;cd=vfe&amp;opi=89978449&amp;ved=0CBMQjRxqFwoTCID-4evO0IQDFQAAAAAdAAAAABAY">here</a> is a particularly beautiful example by Timo Grossenbacher. A choropleth map is a map that shows a geographic landscape with units such as countries, states, or watersheds where each unit is colored according to a variable of interest.</p>
<p>We start by loading the <strong>tidyverse</strong> and <strong>maps</strong> packages. The <strong>maps</strong> package simply contains several simple data files that allow us to create maps.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-1_08772ea90f2be8debe13a67cd19032f6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># load all tidyverse packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)     <span class="co"># Provides latitude and longitude data for various maps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Data</strong>: In addition to data files from the <strong>maps</strong> package, we will use the <a href="https://simple.wikipedia.org/wiki/List_of_U.S._states_by_population">StatePopulation</a> data, which includes the <strong>state name</strong>, <strong>estimated population</strong>, and the <strong>number of electoral college votes</strong> each state is allocated.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-2_aa11b4e5e0500c0a1a1e78a8555a199a">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load United States state map data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>main_states <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read the state population data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/StatePopulation.csv"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(main_states) <span class="co"># See what this looks like</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,537
Columns: 6
$ long      &lt;dbl&gt; -87.46201, -87.48493, -87.52503, -87.53076, -87.57087, -87.5…
$ lat       &lt;dbl&gt; 30.38968, 30.37249, 30.37249, 30.33239, 30.32665, 30.32665, …
$ group     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ order     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…
$ region    &lt;chr&gt; "alabama", "alabama", "alabama", "alabama", "alabama", "alab…
$ subregion &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(state_pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 50
Columns: 3
$ region      &lt;chr&gt; "alabama", "alaska", "arizona", "arkansas", "california", …
$ population  &lt;dbl&gt; 4849377, 737732, 6731484, 2994079, 38802500, 5355856, 3596…
$ elect_votes &lt;dbl&gt; 9, 3, 11, 6, 55, 9, 7, 3, 29, 16, 4, 4, 20, 11, 6, 6, 8, 8…</code></pre>
</div>
</div>
</section>
<section id="making-a-base-map" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Making a base map</h1>
<p>Creating maps follows the same grammar of graphics structure as all other ggplots. Here we use the appropriate dataset (<strong>MainStates</strong>), geom(polygon), and aesthetics (latitude and longitude values) to create a base map.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-3_ea97a224038b9fba234a4028f7455f33">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot all states with ggplot2, using black borders and darkorange fill</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hmm, that color scheme looks familiar</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(main_states) <span class="sc">+</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"darkorange"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try using the hex color code #E25220 instead of "darkorange". Do you </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># recognize the color scheme?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Questions</strong>:</p>
<p>On the first couple pages of the <a href="https://cran.r-project.org/web/packages/maps/maps.pdf">maps package documentation</a>, we see that in addition to <code>state</code>, the <strong>maps</strong> package includes <code>county</code>, <code>france</code>, <code>italy</code>, <code>nz</code>, <code>usa</code>, <code>world</code> and <code>world2</code> files.</p>
<ol type="1">
<li>Follow the example above to create a base map of United States counties. Make sure you use the <code>map_data</code> function as well as the <code>ggplot</code> function.</li>
</ol>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-4_264c926862355f54192bceba566eb9b9">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>all_county <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"county"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_county) <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="2" type="1">
<li>Use the <code>world</code> file to create a base map of the world with white borders and dark blue fill.</li>
</ol>
<ol start="3" type="1">
<li>Notice that the <strong>main_states</strong> file has a column titled “group”. What happens to your base map when group is ignored (i.e.&nbsp;run the code <code>ggplot(main_states) + geom_polygon(aes(x=long, y=lat))</code>)?</li>
</ol>
</section>
<section id="customizing-your-choropleth-map" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Customizing your choropleth map</h1>
<p>Now that we have created a base map of the mainland states, we will color each state according to its population. The first step is to use relational data commands to merge the <strong>main_states</strong> and <strong>state_pop</strong> files.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-7_83da22171f34111e6129ddb94e58241f">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This chunk previews one join operation we'll see next week</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the main_states and state_pop files</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use inner_join to link the population and electoral vote information</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to the state map coordinate data in main_states</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>merged_states <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(main_states, state_pop, <span class="at">by =</span> <span class="st">"region"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(merged_states)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,527
Columns: 8
$ long        &lt;dbl&gt; -87.46201, -87.48493, -87.52503, -87.53076, -87.57087, -87…
$ lat         &lt;dbl&gt; 30.38968, 30.37249, 30.37249, 30.33239, 30.32665, 30.32665…
$ group       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ order       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,…
$ region      &lt;chr&gt; "alabama", "alabama", "alabama", "alabama", "alabama", "al…
$ subregion   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ population  &lt;dbl&gt; 4849377, 4849377, 4849377, 4849377, 4849377, 4849377, 4849…
$ elect_votes &lt;dbl&gt; 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9…</code></pre>
</div>
</div>
<p>Next we create a base map of the mainland United States, using state population as a fill variable.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-8_c2f2d7ab1668bcd0953074666e1e811d">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Choropleth map of the United States</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(merged_states)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fill =</span> population<span class="sc">/</span><span class="dv">1000000</span>), <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">lwd =</span> <span class="fl">0.2</span>) </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>p <span class="co"># save to add/modify below</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Remarks</strong></p>
<ul>
<li><p>Instead of using <code>population</code>, we use <code>population/1000000</code>. Each state is colored by population size (in millions) to make the legend easier to read.</p></li>
<li><p>Border color (white) and line thickness (0.2) are specifically defined within the <code>geom_polygon()</code>.</p></li>
</ul>
<p>Once a map is created, it is often helpful to modify color schemes, determine how to address missing values (<code>na.value</code>) and formalize labels. Notice that we assigned the graph a name, <code>p</code>. This is particularly useful as we add new components to the graph.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-9_e5a6fb17532410bb9fc7011e3bb92ad3">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_fill_continuous</span>(<span class="at">name =</span> <span class="st">"Population(millions)"</span>, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">low =</span> <span class="st">"lightgreen"</span>, <span class="at">high =</span> <span class="st">"darkgreen"</span>,<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">40</span>), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>), <span class="at">na.value =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"State Population in the Mainland United States"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Questions</strong>:</p>
<ol start="4" type="1">
<li><p>What two columns were added to the <strong>main_states</strong> file when it was joined with the <strong>state_population</strong> file?</p></li>
<li><p>Create a choropleth map showing state populations. Make the state borders purple with <code>lwd = 1</code>. Also change the color scale for state populations, with low populations colored white and states with high populations colored dark red.</p></li>
</ol>
<ol start="6" type="1">
<li>Modify the graph and legend in Question 5) to show the log of populations instead of the population in millions. In this map, explain why you will need to set new <code>limits</code> and <code>breaks</code>. <em>Hint: Create a map without setting specific <code>limits</code> and <code>breaks</code> values. How does the graph change?</em></li>
</ol>
<p>The following code provides just a few more examples of how each map can be customized. The <a href="https://ggplot2.tidyverse.org/">ggplot2 website</a> and the <a href="https://rstudio.github.io/cheatsheets/data-visualization.pdf">Data Visualization Cheat Sheet</a> provide many additional detailed examples.</p>
<p>The following code modifies the previous graph by modifying the height and thickness of the legend and by adjusting the color, size and angle of the legend text.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-11_b21742070a749a5f5e8f0f02dc47aed8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="fl">0.5</span>, <span class="at">barheight =</span> <span class="dv">10</span>, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">angle =</span> <span class="dv">45</span>)))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is also possible to overlay two polygon maps. The code below creates county borders with a narrow line and then adds a thicker line to represent state borders. The <code>alpha = .1</code> causes the fill in the state map to be transparent, allowing us to see the county map behind the state map.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-12_6b8165a9dd7e6e47f2b2a5c722650518">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## BE SURE to notice that two different data sets are being used in the two geom_polygon levels.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>all_county <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"county"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> all_county, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">lwd =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> main_states, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>,  <span class="at">lwd =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="adding-points-to-your-choropleth-map" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Adding points to your choropleth map</h1>
<p>The <code>maps</code> package also includes a <code>us.cities</code> file. The following code adds a point for each major city in the United States. Notice that the size of the point is determined by the population of that city.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-13_b770f6b82b97591e750359765a929ac2">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot all states with ggplot</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> us.cities, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">size =</span> pop)) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name =</span> <span class="st">"Population"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>us.cities2 <span class="ot">=</span> <span class="fu">arrange</span>(us.cities, long)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(us.cities2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          name country.etc    pop   lat    long capital
1  Honolulu HI          HI 386345 21.32 -157.80       2
2      Hilo HI          HI  43466 19.70 -155.09       0
3 Anchorage AK          AK 279428 61.18 -149.19       0
4    Juneau AK          AK  31187 58.30 -134.42       2
5 Corvallis OR          OR  50932 44.57 -123.28       0
6    Eugene OR          OR 146483 44.05 -123.11       0</code></pre>
</div>
</div>
<p>It appears that the <code>us.cities</code> file includes cities in Hawaii and in Alaska. We will again use data transformation commands to eliminate these four cities and make a final map of just the mainland.</p>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-14_2b71d45a04f4e3c3c472ada1467e06d4">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot all states with ggplot</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>main_cities <span class="ot">&lt;-</span> <span class="fu">filter</span>(us.cities, long <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">130</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(us.cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,005
Columns: 6
$ name        &lt;chr&gt; "Abilene TX", "Akron OH", "Alameda CA", "Albany GA", "Alba…
$ country.etc &lt;chr&gt; "TX", "OH", "CA", "GA", "NY", "OR", "NM", "LA", "VA", "CA"…
$ pop         &lt;int&gt; 113888, 206634, 70069, 75510, 93576, 45535, 494962, 44933,…
$ lat         &lt;dbl&gt; 32.45, 41.08, 37.77, 31.58, 42.67, 44.62, 35.12, 31.29, 38…
$ long        &lt;dbl&gt; -99.74, -81.52, -122.26, -84.18, -73.80, -123.09, -106.62,…
$ capital     &lt;int&gt; 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(main_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,001
Columns: 6
$ name        &lt;chr&gt; "Abilene TX", "Akron OH", "Alameda CA", "Albany GA", "Alba…
$ country.etc &lt;chr&gt; "TX", "OH", "CA", "GA", "NY", "OR", "NM", "LA", "VA", "CA"…
$ pop         &lt;int&gt; 113888, 206634, 70069, 75510, 93576, 45535, 494962, 44933,…
$ lat         &lt;dbl&gt; 32.45, 41.08, 37.77, 31.58, 42.67, 44.62, 35.12, 31.29, 38…
$ long        &lt;dbl&gt; -99.74, -81.52, -122.26, -84.18, -73.80, -123.09, -106.62,…
$ capital     &lt;int&gt; 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> g <span class="sc">+</span> <span class="fu">geom_polygon</span>(<span class="at">data =</span> merged_states,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> population<span class="sc">/</span><span class="dv">1000000</span>), </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_continuous</span>(<span class="at">name =</span> <span class="st">"State Population"</span>, <span class="at">low =</span> <span class="st">"lightblue"</span>, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">high =</span> <span class="st">"darkblue"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">40</span>), <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>), </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">na.value =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Population (in millions) in the Mainland United States"</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> main_cities, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">size =</span> pop<span class="sc">/</span><span class="dv">1000000</span>), </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">name =</span> <span class="st">"City Population"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom into a particular region of the plot</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>g  <span class="ot">&lt;-</span> g <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">80</span>, <span class="sc">-</span><span class="dv">65</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">38</span>, <span class="dv">46</span>)) <span class="sc">+</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Population (in millions) of Northeastern United States"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IntroMakingMaps_solutions_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="on-your-own" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> On your own</h1>
<ul>
<li>Restrict the <code>states</code> and <code>all.cities</code> files to only a few contiguous states, such as the New England states: New York, Vermont, New Hampshire, Massachusetts, Rhode Island, and Connecticut. You could use the following code:</li>
</ul>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-15_2a47f21437756c2aa5fa252dd1de5251">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ne_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"new york"</span>, <span class="st">"vermont"</span>, <span class="st">"new hampshire"</span>, <span class="st">"massachusetts"</span>, <span class="st">"rhode island"</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"connecticut"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ne_states <span class="ot">&lt;-</span> <span class="fu">filter</span>(merged_states, region <span class="sc">%in%</span> ne_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>Create a map of these states and color each state by the number of electoral votes in that state.</p></li>
<li><p>Add a point to represent each city in these states.</p></li>
<li><p>Color the cities so that state capitals are clearly differentiated from other cities. In the <code>geom_point</code> you may want to use something like the following code:</p></li>
</ul>
<div class="cell" data-hash="IntroMakingMaps_solutions_cache/html/unnamed-chunk-16_4ad793d8817aa34643818a155ee8b4d7">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> g <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data=</span> main_cities, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size =</span> pop<span class="sc">/</span><span class="dv">1000000</span>, <span class="at">color =</span> <span class="fu">factor</span>(capital), <span class="at">shape =</span> <span class="fu">factor</span>(capital)), </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">scale_size</span>(<span class="at">name =</span> <span class="st">"City Population"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="additional-resources" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Additional Resources</h1>
<ul>
<li><p>https://ggplot2.tidyverse.org/reference/: A well-documented list of ggplot2 components with descriptions</p></li>
<li><p>http://www.statmethods.net/advgraphs/ggplot2.html: Quick-R introduction to graphics</p></li>
<li><p>http://stackoverflow.com/tags/ggplot2: Stackoverflow, an online community to share information.</p></li>
<li><p>http://www.cookbook-r.com/Graphs/: R Graphics Cookbook, a text by Winston Chang</p></li>
</ul>
</section>
<section id="acknowledgements" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Acknowledgements</h1>
<p>This tutorial adapts the <a href="https://github.com/ds4stats/r-tutorials">Introduction to Creating Maps with ggplot2</a> tutorial developed in collaborative work across Grinnell College (Shonda Kuiper), Lawrence University (Adam Loy) and Carleton College (Laura Chihara) funded by grants from the ACM and the Teagle Foundation. Their work is licensed under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>